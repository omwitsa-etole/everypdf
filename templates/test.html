<!DOCTYPE html>
<html>
<head>
  <title>Text Detection with Bounding Boxes</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
  <style>
    #container {
      position: relative;
      display: inline-block;
    }
    #outputCanvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>Text Detection with Bounding Boxes</h1>
  <input type="file" id="imageUploader" accept="image/*">
  <div id="container">
    <img id="uploadedImage" style="max-width: 100%;">
    <canvas id="outputCanvas"></canvas>
  </div>

  <script>
    document.getElementById('imageUploader').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.getElementById('uploadedImage');
          img.src = e.target.result;
          img.onload = function() {
            // Create canvas for drawing rectangles
            const canvas = document.getElementById('outputCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas dimensions to match the image
            canvas.width = img.width;
            canvas.height = img.height;

            Tesseract.recognize(
              img.src,
              'eng',
              {
                logger: m => console.log(m),
                tessedit_char_whitelist: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'
              }
            ).then(({ data: { text, words } }) => {
              // Clear previous drawings
              ctx.clearRect(0, 0, canvas.width, canvas.height);

              if (words) {
                // Draw rectangles around detected text
                words.forEach(word => {
                  const { bbox } = word;
                  ctx.strokeStyle = 'red';
                  ctx.lineWidth = 2;
                  ctx.strokeRect(bbox.x0, bbox.y0, bbox.x1 - bbox.x0, bbox.y1 - bbox.y0);
                });
              } else {
                console.warn('No bounding boxes found.');
              }

              // Optionally, display detected text
              console.log('Detected text:', text);
            }).catch(err => {
              console.error(err);
            });
          };
        };
        reader.readAsDataURL(file);
      }
    });
  </script>
</body>
</html>
